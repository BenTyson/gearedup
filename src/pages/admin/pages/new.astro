---
export const prerender = false;

import AdminLayout from '@layouts/AdminLayout.astro';
import PageForm from '@components/admin/PageForm';
import { supabase } from '@lib/supabase';

// Fetch all unique categories from products (pages should match product categories)
const { data: products } = await supabase
  .from('products')
  .select('category');

const categories = [...new Set(products?.map(p => p.category) || [])].sort();

if (categories.length === 0) {
  categories.push('uncategorized');
}
---

<AdminLayout title="New Page" activeNav="pages">
  <div class="max-w-4xl">
    <div class="mb-6">
      <a href="/admin/pages" class="text-sm text-brand-600 hover:text-brand-700 flex items-center gap-1">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
        Back to Pages
      </a>
    </div>

    <h2 class="text-2xl font-bold text-neutral-900 mb-6">Create New Recommendation Page</h2>

    <PageForm client:load categories={categories} />
  </div>
</AdminLayout>
